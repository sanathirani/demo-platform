# NIFTY A-Day Trading Alert System

Automated alert system that sends WhatsApp, Email, and SMS notifications when NIFTY A-Day trading setups occur.

**Note:** This is an alert-only system. No auto-trading is performed.

## What is an A-Day?

An A-Day (Accumulation Day) is a trending day with strong conviction, characterized by:
- **Body ratio > 60%** - The candle body is more than 60% of the total range
- **Volume > 20-day average** - Higher than usual participation
- **Range > 100 points** - Significant price movement

When the previous day was an A-Day, follow-through setups are more likely to work.

## Features

- **A-Day Detection** - Automatically classifies previous day as A-Day or C-Day
- **Multiple Strategies:**
  - ORB Breakout (9:30-10:30 AM)
  - Pullback Continuation (10:15 AM-1:30 PM)
  - Expiry Momentum (11:00 AM-2:00 PM on Thursdays)
- **Smart Strike Selection** - Picks options with premium Rs 80-150
- **Multi-Channel Alerts** - WhatsApp, Email, and SMS
- **Safety Filters** - Prevents duplicate signals, respects time windows, tracks losses

## Prerequisites

- Node.js 18+
- Zerodha Kite Connect API subscription
- Twilio account (for WhatsApp/SMS)
- Gmail account with App Password enabled

## Installation

```bash
# Clone or download the project
cd nifty-aday-alerts

# Install dependencies
npm install

# Copy environment template
cp .env.example .env

# Edit .env with your credentials
nano .env
```

## Configuration

Edit `.env` with your credentials:

```env
# Zerodha Kite API
KITE_API_KEY=your_api_key
KITE_API_SECRET=your_api_secret
KITE_ACCESS_TOKEN=  # Optional - set after daily login

# Twilio (WhatsApp + SMS)
TWILIO_ACCOUNT_SID=your_sid
TWILIO_AUTH_TOKEN=your_token
TWILIO_WHATSAPP_FROM=whatsapp:+14155238886
TWILIO_SMS_FROM=+1234567890

# Email (Gmail)
EMAIL_USER=your@gmail.com
EMAIL_APP_PASSWORD=your_app_password

# Alert Recipients
ALERT_PHONE=+919876543210
ALERT_EMAIL=your@email.com

# Trading Config
MAX_LOSS_PER_TRADE=300000
PREMIUM_MIN=80
PREMIUM_MAX=150
```

### Getting Credentials

#### Zerodha Kite Connect
1. Subscribe to Kite Connect API at [kite.trade](https://kite.trade)
2. Create an app to get API Key and Secret
3. Daily login required - access token expires each day

#### Twilio
1. Create account at [twilio.com](https://www.twilio.com)
2. Get Account SID and Auth Token
3. For WhatsApp: Join Twilio Sandbox or set up Business WhatsApp
4. For SMS: Purchase a phone number

#### Gmail App Password
1. Enable 2FA on your Google account
2. Go to Google Account â†’ Security â†’ App Passwords
3. Generate a new app password for "Mail"

## Usage

### Start the System

```bash
npm start
```

The system will:
1. Start an HTTP server on port 3000
2. Schedule cron jobs for market hours
3. Automatically activate on trading days

### API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/health` | GET | Health check and system status |
| `/state` | GET | Current system state |
| `/test-alert` | POST | Send a test alert |
| `/aday-check` | GET | Manual A-Day check |
| `/check-signals` | POST | Manual signal check |
| `/lock` | POST | Lock trading for the day |
| `/unlock` | POST | Unlock trading |

### Test Commands

```bash
# Check health
curl http://localhost:3000/health

# Send test alert
curl -X POST http://localhost:3000/test-alert

# Check A-Day status
curl http://localhost:3000/aday-check

# Manual signal check
curl -X POST http://localhost:3000/check-signals
```

## Schedule (IST)

| Time | Action |
|------|--------|
| 9:15 AM | Login to Kite, check if previous day was A-Day |
| 9:30 AM | Capture ORB (Open Range Breakout) range |
| 9:31 AM - 3:29 PM | Check signals every minute |
| 3:30 PM | End day, reset state |

## Strategies

### 1. ORB Breakout
- **Time:** 9:30-10:30 AM
- **Logic:** Capture first 15-min candle, signal on breakout close
- **Entry:** CE for breakout above, PE for breakout below
- **Stop Loss:** Opposite side of ORB range

### 2. Pullback Continuation
- **Time:** 10:15 AM - 1:30 PM
- **Logic:** Identify first-hour trend, wait for pullback to 20 EMA
- **Entry:** On break above/below pullback level
- **Stop Loss:** Pullback extreme

### 3. Expiry Momentum
- **Time:** 11:00 AM - 2:00 PM (Thursdays only)
- **Logic:** Strong directional move with 1.5x volume spike
- **Entry:** ATM option in direction of momentum
- **Stop Loss:** Recent swing level

## Alert Format

```
ðŸš¨ A-DAY SIGNAL ðŸš¨

Setup: ORB BREAKOUT
Direction: NIFTY BUY CE

Strike: 22800 CE
Premium: Rs 95
Spot: 22750
Time: 10:02 AM

Stop Loss: Spot below 22450
Target: 2x Risk (Rs 190)
Max Risk: Rs 3,00,000

---
Auto-generated by A-Day Alert System
```

## Project Structure

```
nifty-aday-alerts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # Main entry point
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.js         # Configuration loader
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ kiteService.js    # Zerodha API wrapper
â”‚   â”‚   â”œâ”€â”€ alertService.js   # WhatsApp/Email/SMS
â”‚   â”‚   â””â”€â”€ optionChainService.js  # Strike selection
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”œâ”€â”€ orbStrategy.js    # ORB breakout
â”‚   â”‚   â”œâ”€â”€ pullbackStrategy.js    # Pullback continuation
â”‚   â”‚   â””â”€â”€ expiryMomentumStrategy.js  # Expiry momentum
â”‚   â”œâ”€â”€ filters/
â”‚   â”‚   â”œâ”€â”€ adayFilter.js     # A-Day detection
â”‚   â”‚   â””â”€â”€ safetyFilter.js   # Risk management
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.js         # Winston logging
â”‚       â””â”€â”€ timeUtils.js      # Time helpers
â”œâ”€â”€ logs/                     # Log files (auto-created)
â”œâ”€â”€ .env.example              # Config template
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## Logs

Logs are stored in the `logs/` directory:
- `combined.log` - All logs
- `error.log` - Errors only
- `signals.log` - Trading signals

## Safety Features

1. **One signal per direction per day** - Won't send duplicate CE/PE signals
2. **Time window validation** - Signals only during strategy windows
3. **Max loss tracking** - Locks trading if daily loss limit hit
4. **Manual lock/unlock** - Override via API
5. **Minimum gap between signals** - 5 minutes minimum

## Troubleshooting

### "Please login at: ..."
The Kite access token has expired. You need to:
1. Visit the login URL
2. Complete OAuth flow
3. Extract request_token from redirect URL
4. Update KITE_ACCESS_TOKEN in .env

### Alerts not sending
1. Check credentials in .env
2. Test with `/test-alert` endpoint
3. Check logs for error details

### No signals being generated
1. Verify it's a trading day
2. Check if previous day was an A-Day (`/aday-check`)
3. Ensure system is running (`/health`)
4. Check if trading is locked (`/state`)

## Disclaimer

This system is for educational purposes only. Trading in derivatives involves substantial risk of loss. Past performance is not indicative of future results. Use at your own risk.

## License

ISC
